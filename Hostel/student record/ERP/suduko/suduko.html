<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dynamic Sudoku Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            padding: 25px;
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        h1 {
            color: #1a2a6c;
            margin-bottom: 20px;
            font-size: 28px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 2px;
            background: #333;
            border: 3px solid #000;
            border-radius: 4px;
            margin: 0 auto 20px;
            width: 90vmin;
            max-width: 400px;
        }
        .cell {
            aspect-ratio: 1;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
        }
        .cell.given {
            background: #f0f0f0;
            color: #000;
        }
        .cell.user-correct {
            color: #2e7d32;
            background: #e8f5e9;
        }
        .cell.user-wrong {
            color: #c62828;
            background: #ffebee;
            animation: shake 0.5s;
        }
        .cell.selected {
            background-color: #d1e7ff;
            box-shadow: inset 0 0 0 2px #4361ee;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }
        /* Thick borders for 3x3 boxes */
        .cell:nth-child(3n):not(:nth-child(9n)) { border-right: 2px solid #000; }
        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 2px solid #000; }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 15px auto;
            max-width: 300px;
        }
        .number-btn {
            aspect-ratio: 1;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
        }
        .number-btn:hover {
            background: #e0e0e0;
            transform: scale(1.05);
        }
        .number-btn:active {
            transform: scale(0.95);
        }
        .number-btn.clear {
            grid-column: span 2;
            background: #f72585;
            color: white;
            border-color: #d91a6a;
        }
        .number-btn.clear:hover {
            background: #d91a6a;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        #newGameBtn {
            background: #4361ee;
            color: white;
        }
        #newGameBtn:hover {
            background: #3a56d4;
        }
        #resetBtn {
            background: #f72585;
            color: white;
        }
        #resetBtn:hover {
            background: #d91a6a;
        }
        .message {
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
            min-height: 26px;
        }
        .win {
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ Sudoku Puzzle âœ¨</h1>
        <div class="grid" id="sudokuGrid"></div>
        
        <div class="number-pad" id="numberPad">
            <!-- Numbers 1-9 will be generated by JavaScript -->
        </div>
        
        <div class="message" id="message"></div>
        <div class="controls">
            <button id="newGameBtn">New Game</button>
            <button id="resetBtn">Reset</button>
        </div>
    </div>

    <script>
        // DOM Elements
        const grid = document.getElementById('sudokuGrid');
        const numberPad = document.getElementById('numberPad');
        const messageEl = document.getElementById('message');
        const newGameBtn = document.getElementById('newGameBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Game state
        let solution = [];
        let puzzle = [];
        let userGrid = [];
        let selectedCell = null;

        // Initialize empty grid
        function initGrid() {
            grid.innerHTML = '';
            for (let i = 0; i < 81; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', () => selectCell(i));
                cell.addEventListener('keydown', (e) => handleInput(e, i));
                grid.appendChild(cell);
            }
        }

        // Initialize number pad
        function initNumberPad() {
            numberPad.innerHTML = '';
            
            // Create number buttons 1-9
            for (let i = 1; i <= 9; i++) {
                const btn = document.createElement('div');
                btn.classList.add('number-btn');
                btn.textContent = i;
                btn.dataset.value = i;
                btn.addEventListener('click', () => inputNumber(i));
                numberPad.appendChild(btn);
            }
            
            // Create clear button
            const clearBtn = document.createElement('div');
            clearBtn.classList.add('number-btn', 'clear');
            clearBtn.textContent = 'Clear';
            clearBtn.addEventListener('click', clearCell);
            numberPad.appendChild(clearBtn);
        }

        // Generate a valid Sudoku puzzle
        function generatePuzzle() {
            // Start with empty board
            const board = Array(9).fill().map(() => Array(9).fill(0));
            
            // Fill diagonal 3x3 boxes (they are independent)
            for (let i = 0; i < 9; i += 3) {
                fillBox(board, i, i);
            }
            
            // Solve the rest
            solveSudoku(board);
            
            // Store solution
            solution = board.map(row => [...row]);
            
            // Create puzzle by removing numbers
            puzzle = board.map(row => [...row]);
            removeNumbers(puzzle, 40); // Remove 40 numbers (adjust for difficulty)
            
            // Initialize user grid
            userGrid = puzzle.map(row => [...row]);
        }

        function fillBox(board, row, col) {
            const nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
            let idx = 0;
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    board[row + i][col + j] = nums[idx++];
                }
            }
        }

        function solveSudoku(board) {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (board[row][col] === 0) {
                        const nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
                        for (const num of nums) {
                            if (isValid(board, row, col, num)) {
                                board[row][col] = num;
                                if (solveSudoku(board)) return true;
                                board[row][col] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function isValid(board, row, col, num) {
            // Check row
            for (let x = 0; x < 9; x++) {
                if (board[row][x] === num) return false;
            }
            // Check column
            for (let x = 0; x < 9; x++) {
                if (board[x][col] === num) return false;
            }
            // Check 3x3 box
            const startRow = row - (row % 3);
            const startCol = col - (col % 3);
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[i + startRow][j + startCol] === num) return false;
                }
            }
            return true;
        }

        function removeNumbers(board, count) {
            let removed = 0;
            while (removed < count) {
                const row = Math.floor(Math.random() * 9);
                const col = Math.floor(Math.random() * 9);
                if (board[row][col] !== 0) {
                    board[row][col] = 0;
                    removed++;
                }
            }
        }

        // Render the puzzle on the grid
        function renderGrid() {
            for (let i = 0; i < 81; i++) {
                const row = Math.floor(i / 9);
                const col = i % 9;
                const cell = grid.children[i];
                const value = userGrid[row][col];
                
                cell.textContent = value || '';
                cell.classList.remove('given', 'user-correct', 'user-wrong', 'selected');
                
                if (puzzle[row][col] !== 0) {
                    cell.classList.add('given');
                } else if (value !== 0) {
                    if (value === solution[row][col]) {
                        cell.classList.add('user-correct');
                    } else {
                        cell.classList.add('user-wrong');
                    }
                }
                
                // Highlight selected cell
                if (selectedCell === i) {
                    cell.classList.add('selected');
                }
            }
        }

        // Handle cell selection
        function selectCell(index) {
            const row = Math.floor(index / 9);
            const col = index % 9;
            
            // Only allow selection of empty cells
            if (puzzle[row][col] === 0) {
                selectedCell = index;
                renderGrid();
            } else {
                selectedCell = null;
                renderGrid();
            }
        }

        // Handle keyboard input
        function handleInput(e, index) {
            if (e.key >= '1' && e.key <= '9') {
                const row = Math.floor(index / 9);
                const col = index % 9;
                
                // Only allow input in empty cells
                if (puzzle[row][col] === 0) {
                    userGrid[row][col] = parseInt(e.key);
                    renderGrid();
                    checkWin();
                }
            } else if (e.key === 'Backspace' || e.key === 'Delete') {
                const row = Math.floor(index / 9);
                const col = index % 9;
                if (puzzle[row][col] === 0) {
                    userGrid[row][col] = 0;
                    renderGrid();
                    messageEl.textContent = '';
                }
            }
        }

        // Input number from number pad
        function inputNumber(num) {
            if (selectedCell !== null) {
                const row = Math.floor(selectedCell / 9);
                const col = selectedCell % 9;
                
                // Only allow input in empty cells
                if (puzzle[row][col] === 0) {
                    userGrid[row][col] = num;
                    renderGrid();
                    checkWin();
                }
            }
        }

        // Clear selected cell
        function clearCell() {
            if (selectedCell !== null) {
                const row = Math.floor(selectedCell / 9);
                const col = selectedCell % 9;
                
                // Only allow clearing user inputs
                if (puzzle[row][col] === 0) {
                    userGrid[row][col] = 0;
                    renderGrid();
                    messageEl.textContent = '';
                }
            }
        }

        // Check if the puzzle is solved
        function checkWin() {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (userGrid[row][col] !== solution[row][col]) {
                        return;
                    }
                }
            }
            messageEl.textContent = "ðŸŽ‰ Congratulations! Puzzle Solved!";
            messageEl.className = "message win";
        }

        // Button handlers
        newGameBtn.addEventListener('click', () => {
            generatePuzzle();
            selectedCell = null;
            renderGrid();
            messageEl.textContent = '';
        });

        resetBtn.addEventListener('click', () => {
            userGrid = puzzle.map(row => [...row]);
            selectedCell = null;
            renderGrid();
            messageEl.textContent = '';
        });

        // Start the game
        initGrid();
        initNumberPad();
        generatePuzzle();
        renderGrid();
    </script>
</body>
</html>